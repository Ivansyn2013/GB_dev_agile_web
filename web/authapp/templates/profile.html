{% extends 'base.html' %}
{% load static %}
{% block style %}
    <link rel="stylesheet" type="text/css" href="{% static 'style_profile.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'style_profile_post.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
{% endblock %}
{% block content %}
<div class="profile_container">
    <h1>Profile</h1>
    <div class="avatar">
        {% if user.avatar %}
            <img src="{{ user.avatar.url }}" alt="ava">
        {% else %}
            <img src="/media/not_avatar.jpg" alt="ava">
        {% endif %}
        {% if user.status %}<div>{{ user.status }}</div>{% endif %}
    </div>


    <div class="data_profile_container">
        <div>Имя: <span class="data">{{user.username}}</span></div>
        <div>Email: <span class="data">{{ user.email }}</span></div>
        {% if user.vk %}<div>VK: <span class="data">{{ user.vk }}</span></div>{% endif %}
        {% if user.instagram %}<div>Instagram: <span class="data">{{ user.instagram }}</span></div>{% endif %}
        {% if user.github %}<div>GitHub: <span class="data">{{ user.github }}</span></div>{% endif %}
        <div>Лучший результат: <span class="data">
            {% if profile.top_result %}
                {{profile.top_result}}
            {% else %}
                0
            {% endif %}
        </span></div>
        <div>Количество игр: <span class="data">
            {% if profile.count_game %}
                {{profile.count_game}}
            {% else %}
                0
            {% endif %}
        </span></div>
    </div>
    {% if user.about_me %}
    <div class="about_me">
        <h3>Обо мне</h3>
        <div class="about_me_text">{{ user.about_me }}</div>
    </div>
    {% endif %}

    <a href="{% url 'edit_profile' %}" class="accordion-button">Редактировать профиль</a>
    <a href="{% url 'add_post' %}" class="accordion-button">Создать пост</a>
    <p class="accordion-button" data-toggle="post">Мои посты</p>
</div>

{% include 'inc/post_user.html' with some_variable=post_user %}

<div class="modal" id="confirmDeleteModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- Заголовок модального окна -->
            <div class="modal-header">
                <h4 class="modal-title" style="color: black;">Подтвердите удаление</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Тело модального окна -->
            <div class="modal-body" style="color: black;">
                Вы уверены, что хотите удалить этот пост?
            </div>

            <!-- Футер модального окна -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">Удалить</button>
            </div>
        </div>
    </div>
</div> {# Модальное окно удаления поста #}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'js/post_user_hide.js' %}"></script>
<script>
  $(document).ready(function() {
    $(".delete-post").click(function() {
        var postId = $(this).data("post-id");

        // Установка postId в модальном окне для последующего удаления
        $("#confirmDelete").data("post-id", postId);

        // Отображение модального окна
            $("#confirmDeleteModal").modal("show");
        });

        $("#confirmDelete").click(function() {
            var postId = $(this).data("post-id");
            var currentPost = $(".delete-post[data-post-id='" + postId + "']").closest(".post");


      // Отправляем Ajax-запрос на сервер для удаления поста
      $.ajax({
        url: "http://127.0.0.1:8888/delete_post/" + postId + "/", // URL для удаления поста
        type: "POST",
        data: {
          csrfmiddlewaretoken: "{{ csrf_token }}", // CSRF-токен для безопасности
        },
        success: function(data) {
          if (data.sucses) {
            currentPost.hide();
          } else {
            // Обработка ошибки при удалении поста
            alert("Ошибка при удалении поста: " + data.error);
          }
        },

        error: function() {
          // Обработка ошибки при Ajax-запросе
          alert("Произошла ошибка при выполнении запроса.");
        },
      });
      // Закрытие модального окна после удаления
        $("#confirmDeleteModal").modal("hide");
    });
  });
</script>

{% endblock %}